myApp.controller("CheckListController",["$http","$location","tasksService",function($http,$location,tasksService){vm=this,vm.usertasks=[],$http.get("/user").then(function(response){response.data.username?(vm.firstname=response.data.firstname,vm.userName=response.data.username,vm.allowance=response.data.allowance,console.log("get user response: ",response.data),tasksService.getUserTasks(vm.userName).then(function(){vm.usertasks=tasksService.usertasks,console.log("get usertasks:",vm.usertasks),vm.calcReward()})):$location.path("/home")}),vm.calcReward=function(){var completedTasks=0,required=0;for(i=0;i<=vm.usertasks.length-1;i++)completedTasks+=parseInt(vm.usertasks[i].checkboxcount),required+=parseInt(vm.usertasks[i].frequency);return vm.greenDone=completedTasks/required*100,console.log("green pie graph %",vm.greenDone),vm.allowanceEarned=(vm.greenDone/100*vm.allowance).toFixed(0),console.log(vm.allowanceEarned),vm.progressPercent="width:"+vm.greenDone.toFixed(0)+"%",console.log(vm.progressPercent),vm.data=(vm.allowanceEarned,vm.progressPercent),vm.data},vm.saveCheck=function(task){console.log("in updateTask http request:",task),counter=0;for(var key in task)limit=task.frequency,console.log("limit:",limit),!0===task[key]&&counter<limit&&(counter+=1),task.checkboxcount=counter,console.log(task.checkboxcount);return $http({method:"POST",url:"/tasks/checkbox",data:task}).then(function(response){console.log(response),tasksService.getUserTasks(vm.userName).then(function(){vm.usertasks=tasksService.usertasks,console.log("get usertasks:",vm.usertasks),vm.calcReward()})})},vm.logout=function(){$http.get("/user/logout").then(function(response){console.log("logged out"),$location.path("/home")})}}]);