myApp.controller("UserController",["$http","$location","tasksService","$sce",function($http,$location,tasksService,$sce){var vm=this;vm.data=[],vm.logout=function(){$http.get("/user/logout").then(function(response){console.log("logged out"),$location.path("/home")})},$http.get("/user").then(function(response){response.data.username?(vm.firstname=response.data.firstname,vm.userName=response.data.username,vm.allowance=response.data.allowance,vm.calendar=$sce.trustAsResourceUrl(response.data.calendar),tasksService.getUserTasks(vm.userName).then(function(){vm.usertasks=tasksService.usertasks,console.log("get usertasks in user controller:",vm.usertasks),vm.calcPieGraphPercent()})):$location.path("/home")}),vm.calcPieGraphPercent=function(){var completedTasks=0,required=0;for(i=0;i<=vm.usertasks.length-1;i++)completedTasks+=parseInt(vm.usertasks[i].checkboxcount),required+=parseInt(vm.usertasks[i].frequency);return vm.greenDone=completedTasks/required*100,console.log("green pie graph %",vm.greenDone),vm.redNotDone=100-vm.greenDone,vm.data=[vm.redNotDone.toFixed(0),vm.greenDone.toFixed(0)],vm.valuenow=(vm.greenDone/100*vm.allowance).toFixed(0),console.log(vm.valuenow),vm.progressPercent="width:"+vm.greenDone.toFixed(0)+"%",console.log(vm.progressPercent),vm.data},vm.labels=["Keep up the great work to earn your allowance!","Completed Chores.  Great Job!"],vm.colorsPie=["#DC143C","#008000"],vm.optionsPie={legend:{display:!0},responsive:!0,scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left"}]}},vm.clickme=function($event){alert($event[0]._view.label)}}]);